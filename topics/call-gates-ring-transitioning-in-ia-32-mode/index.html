<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Call Gates’ Ring Transitioning in IA-32 Mode" /><meta name="author" content="Sina Karvandi" /><meta property="og:locale" content="en" /><meta name="description" content="We write about Windows Internals, Hypervisors, Linux, and Networks." /><meta property="og:description" content="We write about Windows Internals, Hypervisors, Linux, and Networks." /><link rel="canonical" href="https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/" /><meta property="og:url" content="https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/" /><meta property="og:site_name" content="Rayanfam Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-01-15T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Call Gates’ Ring Transitioning in IA-32 Mode" /><meta name="twitter:site" content="@Intel80x86" /><meta name="twitter:creator" content="@Sina Karvandi" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sina Karvandi"},"dateModified":"2024-07-13T12:45:21+00:00","datePublished":"2019-01-15T00:00:00+00:00","description":"We write about Windows Internals, Hypervisors, Linux, and Networks.","headline":"Call Gates’ Ring Transitioning in IA-32 Mode","mainEntityOfPage":{"@type":"WebPage","@id":"https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/"},"url":"https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/"}</script><title>Call Gates' Ring Transitioning in IA-32 Mode | Rayanfam Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rayanfam Blog"><meta name="application-name" content="Rayanfam Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/images/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rayanfam Blog</a></div><div class="site-subtitle font-italic">An aggressive out-of-order, superscalar blog...</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tutorials/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>TUTORIALS</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>TOOLS & SCRIPTS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/rayanfam" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/Intel80x86" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sina','rayanfam.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Call Gates' Ring Transitioning in IA-32 Mode</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Call Gates' Ring Transitioning in IA-32 Mode</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/Intel80x86">Sina Karvandi</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1547510400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2019-01-15 </em> </span> <span> Updated <em class="timeago" data-ts="1720874721" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-07-13 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1945 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="../../assets/images/ring-transitions-cover.png" alt="" data-proofer-ignore></p><p>Have you ever thought how transitions between different rings performed?</p><p>Well, SYSENTER &amp; SYSCALL used in modern OSs for transitioning between ring 3 to ring 0 but if there are other rings, then what’s Intel solution for entering them? The answer is <strong>call gates</strong>.</p><p>The rest of this topic described how to use call gates in modern processors.</p><p>80386 and its successors have 4 levels protections which isolate and protect user programs from each other and the operating system.</p><p>It offers an additional type of protection on a page basis, when paging is enabled(using U/S and R/W fields) .</p><p>There are 3 different types of privilege level checks when using call-gates:</p><ul><li><p>Current Privilege Level (CPL)</p><li><p>Descriptor Privilege Level (DPL)</p><li><p>Requestor Privilege Level (RPL)</p></ul><h2 id="current-privilege-level-cpl"><span class="mr-2">Current Privilege Level (CPL)</span><a href="#current-privilege-level-cpl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>CPL is stored in the selector of currently executing CS register. It represents the privilege level (PL) of the currently executing task. It is also PL in the descriptor of the code segment and designated as Task Privilege Level (TPL).</p><h2 id="descriptor-privilege-level-dpl"><span class="mr-2">Descriptor Privilege Level (DPL)</span><a href="#descriptor-privilege-level-dpl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>It is the PL of the object which is being attempted to be accessed by the current task or in the other words, the least privilege level for the caller to use this gate.</p><h2 id="requestor-privilege-level-rpl"><span class="mr-2">Requestor Privilege Level (RPL)</span><a href="#requestor-privilege-level-rpl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>It is the lowest two bits of any selector. It can be used to weaken the CPL if desired.</p><p>The Effective Privilege Level (EPL) is EPL = max (CPL, RPL) (here numbers) Thus the task becomes less privileged.</p><p>Note that PL refers to Privilege Level.</p><p>Keep in mind that the above concepts also applies in other Intel structures</p><h2 id="gdt-entries"><span class="mr-2">GDT Entries</span><a href="#gdt-entries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>GDT Stands for <strong>Global Descriptor Table</strong>. It contains some Segmentation Descriptors used in the age of memory segmentation and now it can be used to implement some segment change techniques like heavens gate.</p><p>In our case we use GDT as a table for our call gate descriptor. I didn’t see any use of call gates in Windows or Linux, by the way it’s a feature that exsits in processors. (Even in AMD64 and IA32e).</p><p>The GDT Entry Descriptor defined like this :</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_GDT_ENTRY</span> <span class="p">{</span>
	<span class="n">UINT16</span> <span class="n">LIMIT15_0</span><span class="p">;</span>
	<span class="n">UINT16</span> <span class="n">BASE15_0</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">BASE23_16</span><span class="p">;</span>

	<span class="n">UINT8</span> <span class="n">TYPE</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">SUBTYPE</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">Accessibility</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">Access</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">UINT8</span> <span class="n">S</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">DPL</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">PRESENT</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">UINT8</span> <span class="n">LIMIT19_16</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">AVL</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">L</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">D</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">GRANULARITY</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">UINT8</span> <span class="n">BASE31_24</span><span class="p">;</span>
<span class="p">}</span><span class="n">GDT_ENTRY</span><span class="p">,</span> <span class="o">*</span><span class="n">PGDT_ENTRY</span><span class="p">;</span>
</pre></table></code></div></div><p>For more information about GDT, you can read <a href="https://www.codeproject.com/Articles/45788/The-Real-Protected-Long-mode-assembly-tutorial-for">this</a> article and also <a href="https://wiki.osdev.org/Global_Descriptor_Table">this</a> <a href="https://wiki.osdev.org/Global_Descriptor_Table">osdev</a> <a href="https://wiki.osdev.org/Global_Descriptor_Table">topic</a>.</p><p>When the <code class="language-c highlighter-rouge"><span class="n">S</span></code> flag is set to 0, the meaning of a GDT entry is quite different so it’s no longer a segment descriptor and now we can use this entry as a call-gate descriptor.</p><p>More information about call gates implementation, later in this topic.</p><h2 id="restricting-access-to-data"><span class="mr-2">Restricting Access to Data</span><a href="#restricting-access-to-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Assume that a task needs data from the data segment. The privilege levels are checked at the time a selector for the target segment is loaded into the data segment register. Three privilege levels enter into privilege checking mechanism.</p><ul><li>CPL<li>RPL of the selector of the target segment<li>DPL of the descriptor of the target segment</ul><p>Note that access is allowed only if DPL ≥ Max(CPL, RPL) and A procedure can only access the data that is at the same or less privilege level.</p><h2 id="call--jmps-near-vs-far"><span class="mr-2">CALL &amp; JMPs (Near vs Far)</span><a href="#call--jmps-near-vs-far" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The near forms of JMP and CALL transfer within the current code segment and requires only limit checking. The far forms of JMP and CALL refer to other segments and require privilege checking.</p><p>The far JMP and CALL can be done in 2 ways:</p><ul><li><strong>Without Call Gate Descriptor</strong></ul><p>The processor permits a JMP or CALL directly to another segment only if :</p><p>1. DPL of the target segment = CPL of the calling segment</p><p>2. Confirming bit of the target code is set and DPL of the target segment ≤ CPL</p><p>Confirming Segment: These segments may be called from various privilege levels but execute at the privilege level of the calling procedure. (e.g. math library)</p><ul><li><strong>With Call Gate Descriptor</strong></ul><p>The far pointer of the control transfer instruction uses the selector part of the pointer and selects a gate. The selector and offset fields of a gate form a pointer to the entry of a procedure.</p><h2 id="ring-transitioning"><span class="mr-2">Ring Transitioning</span><a href="#ring-transitioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>When CPU fetches a far-call instruction, it will use that instruction’s ‘selector’ value to look up a descriptor in the GDT (or in the current LDT).</p><p>If it’s a ‘call-gate’ descriptor, and if access is allowed (i.e. if CPL ≤ DPL), then the CPU will perform a complex sequence of actions which will accomplish the requested ‘ring-transition’. CPL (Current Privilege Level) is based on least significant 2-bits in register CS (also in SS)</p><ul><li>pushes the current SS:SP register<li>values onto a new stack-segment-<li>copies the specified number of parameters from the old stack onto the new stack<li>pushes the updated CS:IP register-values onto the new stack<li>loads new values into registers CS:IP (from the call gate descriptor) and into SS:SP</ul><p>Where do the new values for SS:SP come from? (They’re not found in the call-gate)</p><p>They’re from a special system-segment, known as the TSS (Task State Segment). The CPU locates its TSS by referring to the value in register TR (Task Register).</p><p><strong>Return to an Outer Ring</strong></p><ul><li>Use the far-return instruction: ‘lret’<ul><li>Restores CS:IP from the current stack<li>Restores SS:SP from the current stack</ul><li>Use the far-return instruction: ‘lret $n’<ul><li>Restores CS:IP from the current stack<li>Discards n parameter-bytes from that stack<li>Restores SS:SP from that current stack</ul></ul><h2 id="call-gate-descriptor"><span class="mr-2">Call-Gate Descriptor</span><a href="#call-gate-descriptor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Intel defines a call-gate descriptor like this (in x86 environment):</p><p><img data-src="../../assets/images/32-bit-call-gates.png" alt="" data-proofer-ignore></p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">CALL_GATE32</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">offset0_15</span> <span class="o">:</span> <span class="mi">16</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">selector</span> <span class="o">:</span> <span class="mi">16</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">argCount</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">zeros</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">type</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">sFlag</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">dpl</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">pFlag</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">part</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">all</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">dummy</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">offset16_31</span> <span class="o">:</span> <span class="mi">16</span><span class="p">;</span>
<span class="p">}</span><span class="n">CALL_GATE32</span><span class="p">,</span> <span class="o">*</span><span class="n">PCALL_GATE32</span><span class="p">;</span>
</pre></table></code></div></div><ul><li>P = present (1 = yes, 0 = no)<li>DPL = Descriptor Privilege Level (0, 1 ,2 ,3)<li>Code-selector (specifies memory-segment containing procedure code)<li>Offset (specifies the procedure’s entry-point within its code-segment)<li>Parameter count (specifies how many parameter-values will be copied)<li>Gate-Type (‘0x4’ means a 16-bit call-gate, ‘0xC’ means a 32-bit call-gate)</ul><p>The above descriptor is also available in AMD64 and it defines like the following picture.</p><p><img data-src="../../assets/images/64-bit-call-gates.png" alt="" data-proofer-ignore></p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">CALL_GATE</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kr">__int32</span> <span class="n">offset0_15</span> <span class="o">:</span> <span class="mi">16</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kr">__int32</span> <span class="n">selector</span> <span class="o">:</span> <span class="mi">16</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">ist</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">ignored</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">type</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">dpl</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">p</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">part</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">all</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">dummy</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">__int64</span> <span class="n">offset16_63</span> <span class="o">:</span> <span class="mi">48</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kr">__int32</span> <span class="n">reserved</span> <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
<span class="p">}</span><span class="n">CALL_GATE</span><span class="p">,</span> <span class="o">*</span><span class="n">PCALL_GATE</span><span class="p">;</span>
</pre></table></code></div></div><p>Call gates facilitate controlled transfers of program control between different privilege levels. They are typically used only in operating systems or executives that use the privilege-level protection mechanism. Call gates are also useful for transferring program control between 16-bit and 32-bit code segments</p><p>Now, let’s see different types of entries that can be used in GDT Entries (the “<strong>type</strong>” field of above descriptors).</p><ul><li><strong>Bits 3 2 1 0 : Type</strong> <strong>of the entry</strong><ul><li>0000 - Reserved<li>0001 - Available 16-bit TSS<li>0010 - Local Descriptor Table (LDT)<li>0011 - Busy 16-bit TSS<li>0100 - 16-bit Call Gate<li>0101 - Task Gate<li>0110 - 16-bit Interrupt Gate<li>0111 - 16-bit Trap Gate<li>1000 - Reserved<li>1001 - Available 32-bit TSS<li>1010 - Reserved<li>1011 - Busy 32-bit TSS<li>1100 - 32-bit Call Gate<li>1101 - Reserved<li>1110 - 32-bit Interrupt Gate<li>1111 - 32-bit Trap Gate</ul></ul><h2 id="implementation"><span class="mr-2">Implementation</span><a href="#implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Enough for theory, let’s see how we can use them in a real environment.</p><p>The full source code is available on Github:</p><p>[<a href="https://github.com/SinaKarvandi/IA32-CALL-GATES"></a><a href="https://github.com/SinaKarvandi/IA32-CALL-GATES">https://github.com/SinaKarvandi/IA32-CALL-GATES</a>]</p><p>After defining the above structures, now we need to declare a structure with the following assumptions.</p><p><strong>Selector</strong> field should be 0x8 (pointing to <strong>KGDT_R0_CODE</strong> entry of GDT). As I told you about the <strong>type</strong> it should be 0xc and the minimum ring that can invoke this call-gate is (<strong>dpl</strong> = 0x3 (user-mode)) and of course, it’s <strong>present</strong> in memory.</p><p>The address should be divided into two 16 bit parts.</p><p>The following function is responsible for making a Windbg command that can be executed in order to defined a call-gate. Of course you can do the same thing using a kernel mode driver.</p><p>Note that <strong>address</strong> is the kernel handler function, <strong>gdtr</strong> is the result of “<strong>r gdtr</strong>” and <strong>GDTIndex</strong> is the GDT index that we want to modify.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">CreateCallGateStruct</span><span class="p">(</span><span class="kt">int</span> <span class="n">address</span> <span class="p">,</span> <span class="kt">int</span> <span class="n">gdtr</span> <span class="p">,</span> <span class="kt">int</span> <span class="n">GDTIndex</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">CALL_GATE32</span> <span class="n">callgate32</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">dummy</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="n">zeros</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">selector</span> <span class="o">=</span> <span class="mh">0x8</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">dummy</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mh">0xc</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">dummy</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="n">sFlag</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">dummy</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="n">dpl</span> <span class="o">=</span> <span class="mh">0x3</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">dummy</span><span class="p">.</span><span class="n">part</span><span class="p">.</span><span class="n">pFlag</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">offset0_15</span> <span class="o">=</span> <span class="mh">0x0000ffff</span> <span class="o">&amp;</span> <span class="n">address</span><span class="p">;</span>
	<span class="n">address</span> <span class="o">=</span> <span class="n">address</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">callgate32</span><span class="p">.</span><span class="n">offset16_31</span> <span class="o">=</span> <span class="mh">0x0000ffff</span> <span class="o">&amp;</span> <span class="n">address</span><span class="p">;</span>


	<span class="n">printf</span><span class="p">(</span><span class="s">"eq %x+(0x8*0x%x) "</span><span class="p">,</span> <span class="n">gdtr</span> <span class="p">,</span> <span class="n">GDTIndex</span><span class="p">);</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">"%04x"</span><span class="p">,</span> <span class="n">callgate32</span><span class="p">.</span><span class="n">offset16_31</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%04x"</span><span class="p">,</span> <span class="n">callgate32</span><span class="p">.</span><span class="n">dummy</span><span class="p">.</span><span class="n">all</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%04x"</span><span class="p">,</span> <span class="n">callgate32</span><span class="p">.</span><span class="n">selector</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"%04x"</span><span class="p">,</span> <span class="n">callgate32</span><span class="p">.</span><span class="n">offset0_15</span><span class="p">);</span>

<span class="p">}</span>
</pre></table></code></div></div><p><img data-src="../../assets/images/break-handler.png" alt="" data-proofer-ignore></p><p>Let’s execute the above code and see the results.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>	<span class="c1">// Making windbg structure</span>

	<span class="kt">int</span> <span class="n">DispatcherAddress</span><span class="o">=</span> <span class="mh">0x8176fcd4</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">gdtr</span> <span class="o">=</span> <span class="mh">0x80b5b000</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">GdtIndex</span> <span class="o">=</span> <span class="mh">0x64</span><span class="p">;</span>

	<span class="n">CreateCallGateStruct</span><span class="p">(</span><span class="n">DispatcherAddress</span><span class="p">,</span> <span class="n">gdtr</span><span class="p">,</span> <span class="n">GdtIndex</span><span class="p">);</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">callGate</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="n">callGate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
	<span class="n">callGate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
	<span class="n">callGate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x320</span><span class="p">;</span>

	<span class="c1">// Invoke the far call</span>

	<span class="kr">__asm</span> <span class="p">{</span> <span class="kt">int</span> <span class="mi">3</span> <span class="p">}</span>
	<span class="kr">__asm</span>
	<span class="p">{</span>
		<span class="n">call</span> <span class="n">fword</span> <span class="n">ptr</span><span class="p">[</span><span class="n">callGate</span><span class="p">];</span>
	<span class="p">}</span>
</pre></table></code></div></div><p>The final result is :</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">eq</span> <span class="mi">80</span><span class="n">b5b000</span><span class="o">+</span><span class="p">(</span><span class="mh">0x8</span><span class="o">*</span><span class="mh">0x64</span><span class="p">)</span> <span class="n">ffff8176ec000008fffffcd4</span>
</pre></table></code></div></div><p><img data-src="../../assets/images/call-gate-structure.png" alt="" data-proofer-ignore></p><p>If you look more precisely at the above code, you can see that, the last part is the definition of <strong>callGate</strong> array. This array chooses GDT index which your call-gate descriptor is located.</p><p>I choose 320 because the segment selector defines like this :</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="mi">15</span>                                                 <span class="mi">3</span>    <span class="mi">2</span>        <span class="mi">0</span>
<span class="o">+--------------------------------------------------+----+--------+</span>
<span class="o">|</span>          <span class="n">Index</span>                                   <span class="o">|</span> <span class="n">TI</span> <span class="o">|</span>   <span class="n">RPL</span>  <span class="o">|</span>
<span class="o">+--------------------------------------------------+----+--------+</span>

<span class="n">TI</span> <span class="o">=</span> <span class="n">Table</span> <span class="n">Indicator</span><span class="o">:</span> <span class="mi">0</span> <span class="o">=</span> <span class="n">GDT</span><span class="p">,</span> <span class="mi">1</span> <span class="o">=</span> <span class="n">LDT</span>
</pre></table></code></div></div><p>We select 320 (10100’0’000), RPL (000) TI (0 because our descriptor is on GDT, not LDT), the index is 100 (0x64 or 10100 in binary).</p><p>The last part is executing our FAR CALL. After the execution of this call we will be in our dispatcher address with Kernel Privilege Level. By now you should be aware of how to go to other rings (e.g ring 1,2) by modifying the above structures and the selectors.</p><p><img data-src="../../assets/images/usermode-far-call.png" alt="" data-proofer-ignore></p><p>The last thing is you should handle this situation and finally return to the previous rings using <strong>lret.</strong></p><p>That’s it.</p><h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In this topic, we see how transitions between different rings are performed in our processor, even if almost all of the modern OSs don’t use this mechanism. For more i.formation you can review the following references.</p><h2 id="references"><span class="mr-2">References</span><a href="#references" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>[1] Intel 64 and IA-32 Architectures Software Developer’s Manual Vol. 3A – Chapter 5 – (5.8.3 Call Gates) (<a href="https://software.intel.com/en-us/articles/intel-sdm">https://software.intel.com/en-us/articles/intel-sdm</a>)</p><p>[2] Intel 64 and IA-32 Architectures Software Developer’s Manual Vol. 3A – Chapter 5 – (5.8.4 Accessing a Code Segment Through a Call Gate) (<a href="https://software.intel.com/en-us/articles/intel-sdm">https://software.intel.com/en-us/articles/intel-sdm</a>)</p><p>[4] 80386DX - (<a href="https://slideplayer.com/slide/9375765">https://slideplayer.com/slide/9375765</a>)</p><p>[5] Processor Privilege Levels - (<a href="https://slideplayer.com/slide/1652112"></a><a href="https://slideplayer.com/slide/1652112/">https://slideplayer.com/slide/1652112</a>)</p><p>[6] The Real, Protected, Long mode assembly tutorial for PCs - (<a href="https://www.codeproject.com/Articles/45788/The-Real-Protected-Long-mode-assembly-tutorial-for">https://www.codeproject.com/Articles/45788/The-Real-Protected-Long-mode-assembly-tutorial-for</a>)</p><p>[7] Hooking the GDT - Installing Call gates - (<a href="https://github.com/David-Reguera-Garcia-Dreg/cgaty"></a><a href="https://github.com/David-Reguera-Garcia-Dreg/cgaty">https://github.com/David-Reguera-Garcia-Dreg/cgaty</a>)</p><p>[8] The rootkit arsenal book – (<a href="https://www.amazon.com/Rootkit-Arsenal-Escape-Evasion-Corners/dp/1598220616">https://www.amazon.com/Rootkit-Arsenal-Escape-Evasion-Corners/dp/1598220616</a>)</p><p>[9] Bringing Call Gates Back – (<a href="http://www.alex-ionescu.com/?p=340"></a><a href="http://www.alex-ionescu.com/?p=340">http://www.alex-ionescu.com/?p=340</a>)</p><p>[10] Descriptor tables in kernel exploitation – (<a href="https://j00ru.vexillium.org/2010/01/descriptor-tables-in-kernel-exploitation-a-new-article/">https://j00ru.vexillium.org/2010/01/descriptor-tables-in-kernel-exploitation-a-new-article/</a>)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cpu/'>cpu</a>, <a href='/categories/windows/'>windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/call-gate/" class="post-tag no-text-decoration" >call-gate</a> <a href="/tags/call-gate-descriptor/" class="post-tag no-text-decoration" >call-gate-descriptor</a> <a href="/tags/changing-to-ring-1-or-2/" class="post-tag no-text-decoration" >changing-to-ring-1-or-2</a> <a href="/tags/ring-transitioning/" class="post-tag no-text-decoration" >ring-transitioning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Call Gates&#39; Ring Transitioning in IA-32 Mode - Rayanfam Blog&amp;url=https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Call Gates&#39; Ring Transitioning in IA-32 Mode - Rayanfam Blog&amp;u=https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/&amp;text=Call Gates&#39; Ring Transitioning in IA-32 Mode - Rayanfam Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/topics/hypervisor-from-scratch-part-1/">Hypervisor From Scratch - Part 1: Basic Concepts & Configure Testing Environment</a><li><a href="/topics/hypervisor-from-scratch-part-2/">Hypervisor From Scratch – Part 2: Entering VMX Operation</a><li><a href="/topics/hypervisor-from-scratch-part-5/">Hypervisor From Scratch – Part 5: Setting up VMCS & Running Guest Code</a><li><a href="/topics/hypervisor-from-scratch-part-6/">Hypervisor From Scratch – Part 6: Virtualizing An Already Running System</a><li><a href="/topics/hypervisor-from-scratch-part-7/">Hypervisor From Scratch – Part 7: Using EPT & Page-Level Monitoring Features</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hypervisor/">hypervisor</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/debian/">debian</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/cisco/">cisco</a> <a class="post-tag" href="/tags/invept/">invept</a> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/vmcs/">vmcs</a> <a class="post-tag" href="/tags/active-directory/">active-directory</a> <a class="post-tag" href="/tags/cache/">cache</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/topics/hypervisor-from-scratch-part-5/"><div class="card-body"> <em class="timeago small" data-ts="1544918400" > 2018-12-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hypervisor From Scratch – Part 5: Setting up VMCS & Running Guest Code</h3><div class="text-muted small"><p> If you’re looking to use a hypervisor for analysis and reverse engineering tasks, check out HyperDbg Debugger. It’s a hypervisor-based debugger designed specifically for analyzing, fuzzing, and r...</p></div></div></a></div><div class="card"> <a href="/topics/hypervisor-from-scratch-part-6/"><div class="card-body"> <em class="timeago small" data-ts="1551052800" > 2019-02-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hypervisor From Scratch – Part 6: Virtualizing An Already Running System</h3><div class="text-muted small"><p> If you’re looking to use a hypervisor for analysis and reverse engineering tasks, check out HyperDbg Debugger. It’s a hypervisor-based debugger designed specifically for analyzing, fuzzing, and r...</p></div></div></a></div><div class="card"> <a href="/topics/finding-the-real-access-rights-needed-by-handles/"><div class="card-body"> <em class="timeago small" data-ts="1559779200" > 2019-06-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Why you should not always trust MSDN: Finding Real Access Rights Needed By Handles</h3><div class="text-muted small"><p> Introduction Hi guys, The title of this topic is somehow weird, if you think everything in MSDN is 100% match with what Microsoft implemented in Windows (like what I used to think), you’re defi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/topics/hypervisor-from-scratch-part-5/" class="btn btn-outline-primary" prompt="Older"><p>Hypervisor From Scratch – Part 5: Setting up VMCS & Running Guest Code</p></a> <a href="/topics/packetscript-lua-kernel/" class="btn btn-outline-primary" prompt="Newer"><p>PacketScript overview: A Lua scripting engine for in-kernel packet processing</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rayanfam.com/topics/call-gates-ring-transitioning-in-ia-32-mode/'; this.page.identifier = '/topics/call-gates-ring-transitioning-in-ia-32-mode/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rayanfam.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/rayanfam">Rayanfam Blog</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hypervisor/">hypervisor</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/debian/">debian</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/cisco/">cisco</a> <a class="post-tag" href="/tags/invept/">invept</a> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/vmcs/">vmcs</a> <a class="post-tag" href="/tags/active-directory/">active-directory</a> <a class="post-tag" href="/tags/cache/">cache</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-P6M1BDG57Z"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-P6M1BDG57Z'); }); </script>
